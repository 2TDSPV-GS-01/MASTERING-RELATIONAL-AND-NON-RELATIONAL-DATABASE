CREATE OR REPLACE FUNCTION FUNC_MEDIA_VALOR_POR_SENSOR (
    V_TIPO_SENSOR IN VARCHAR2
) RETURN NUMBER IS
    V_MEDIA NUMBER;
BEGIN
    SELECT AVG(NR_RESULTADO)
    INTO V_MEDIA
    FROM T_FV_REGISTRO_MEDIDA R
    JOIN T_FV_SENSOR S ON R.ID_SENSOR = S.ID_SENSOR
    WHERE S.TP_SENSOR = V_TIPO_SENSOR;

    RETURN  ROUND(V_MEDIA, 4);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
END;
/

-- SELECT FUNC_MEDIA_VALOR_POR_SENSOR('PH') FROM DUAL;

CREATE OR REPLACE FUNCTION FUNC_TOTAL_POR_FORNECEDOR(
    V_CNPJ IN CHAR
) RETURN NUMBER IS 
    V_TOTAL NUMBER := 0;
    BEGIN
        SELECT SUM(NR_QUANT_ESTOQUE * NR_PRECO_UNIDADE) INTO V_TOTAL
        FROM T_FV_MATERIAL 
        WHERE DS_CNPJ = V_CNPJ;

    RETURN ROUND(V_TOTAL, 2);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
    WHEN OTHERS THEN
        RETURN NULL;
END;
/ 

-- SELECT  FUNC_TOTAL_POR_FORNECEDOR('15432919000101') AS TOTAL_INVESTIDO FROM DUAL;